---
import NavBar from "../components/NavBar.astro";
import StarField from "../components/StarField.astro";
import BackToTop from "../components/BackToTop.astro";
import { ClientRouter } from 'astro:transitions';
import '../styles/fonts.css';
import '../styles/tailwind.css';
import '../styles/design-system.css';
import { execSync } from 'child_process';

interface Props {
    title: string;
    description?: string;
    ogType?: string;
    image?: string;
    showFooter?: boolean;
}

const { title, description = "Nick Russo - Software Engineer", ogType = "website", image } = Astro.props;
const ogImage = image ? new URL(image, Astro.site) : undefined;

// Get git commit hash at build time
const gitHash = execSync('git rev-parse --short HEAD').toString().trim();
const pathname = Astro.url.pathname;
const canonicalURL = new URL(pathname, Astro.site);

const { showFooter = true } = Astro.props;
---

<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="icon" type="image/svg+xml" href="/favicon.ico" />
        <meta name="generator" content={Astro.generator} />
        <meta name="description" content={description} />
        <title>{title}</title>

        <!-- Canonical URL -->
        <link rel="canonical" href={canonicalURL} />

        <!-- Open Graph / Facebook -->
        <meta property="og:type" content={ogType} />
        <meta property="og:url" content={canonicalURL} />
        <meta property="og:title" content={title} />
        <meta property="og:description" content={description} />
        <meta property="og:site_name" content="Nick Russo" />
        {ogImage && <meta property="og:image" content={ogImage} />}

        <!-- Twitter -->
        <meta property="twitter:card" content={ogImage ? "summary_large_image" : "summary"} />
        <meta property="twitter:url" content={canonicalURL} />
        <meta property="twitter:title" content={title} />
        <meta property="twitter:description" content={description} />
        <meta property="twitter:creator" content="@nijaru0x" />
        {ogImage && <meta property="twitter:image" content={ogImage} />}

        <!-- Fonts loaded via Fontsource -->

        <ClientRouter />
        <slot name="head" />
    </head>
    <body class="min-h-screen" style="background-color: var(--color-background); color: var(--color-text-primary);">
        <div class="page-wrapper">
            <div transition:persist>
                <StarField />
            </div>
            <NavBar />

            <main class="pt-24 pb-16 min-h-screen">
                <slot />
            </main>

            {showFooter && (
                <footer class="border-t py-8 text-center" style="border-color: var(--color-border-subtle);">
                    <div class="container container-md">
                        <p class="body-small text-text-tertiary">© {new Date().getFullYear()} Nick Russo • Built with <a href="https://astro.build" target="_blank" rel="noopener noreferrer" class="link-primary">Astro</a></p>
                        <p class="text-xs mt-2" style="color: #08090a; user-select: text;">{gitHash}</p>
                    </div>
                </footer>
            )}

            <BackToTop />
        </div>
    </body>
</html>

<style is:global>
    html {
        scroll-behavior: smooth;
        font-size: 112.5%; /* 18px base */
        overflow-x: hidden;
        max-width: 100vw;
    }

    body {
        font-family:
            "Geist Sans",
            system-ui,
            -apple-system,
            BlinkMacSystemFont,
            "Segoe UI",
            sans-serif;
        font-weight: 400;
        color: #ffffff;
        max-width: 100vw;
        overflow-x: hidden;
    }

    /* Headings use Exo 2 */
    h1, h2, h3, h4, h5, h6,
    .heading-hero, .heading-1, .heading-2, .heading-3 {
        font-family: "Exo 2", system-ui, sans-serif;
    }

    .page-wrapper {
        width: 100%;
        position: relative;
    }

    /* Monospace font for code elements */
    code, pre, .font-mono {
        font-family:
            "JetBrains Mono",
            "SF Mono",
            Monaco,
            Consolas,
            "Liberation Mono",
            Menlo,
            monospace;
    }

    /* Custom scrollbar */
    ::-webkit-scrollbar {
        width: 8px;
        background: transparent;
    }

    ::-webkit-scrollbar-track {
        background: transparent;
    }

    ::-webkit-scrollbar-thumb {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 4px;
        border: 2px solid transparent;
        background-clip: content-box;
    }

    ::-webkit-scrollbar-thumb:hover {
        background: rgba(255, 255, 255, 0.2);
        border: 2px solid transparent;
        background-clip: content-box;
    }

    ::selection {
        background: var(--color-accent-30);
        color: #ffffff;
    }
</style>
