---
import Layout from "./Layout.astro";
import CodeBlock from "../components/CodeBlock.astro";
import HiringNotice from "../components/HiringNotice.astro";
import { calculateReadingTime } from "../utils/readingTime";
import type { CollectionEntry } from 'astro:content';
import '../styles/markdown.css';

interface Props {
    post: CollectionEntry<'blog'>;
    prevPost?: CollectionEntry<'blog'> | null;
    nextPost?: CollectionEntry<'blog'> | null;
}

const { post, prevPost = null, nextPost = null } = Astro.props;
const { title, pubDate, description, author, tags, image } = post.data;

// Format the date
const formattedDate = pubDate.toLocaleDateString("en-US", {
    year: "numeric",
    month: "long",
    day: "numeric",
});

const readingTime = calculateReadingTime(post.body);
---

<Layout title={title + " - Nick Russo"} description={description} ogType="article" image={image?.url}>
    <Fragment slot="head">
        <!-- Open Graph Article Metadata -->
        <meta property="article:published_time" content={pubDate.toISOString()} />
        <meta property="article:author" content={author} />
        {tags.map((tag) => <meta property="article:tag" content={tag} />)}

        <!-- Schema.org structured data for blog post -->
        <script
            type="application/ld+json"
            set:html={JSON.stringify({
                "@context": "https://schema.org",
                "@type": "BlogPosting",
                headline: title,
                description: description,
                image: image?.url,
                author: {
                    "@type": "Person",
                    name: author,
                },
                publisher: {
                    "@type": "Person",
                    name: author,
                },
                datePublished: pubDate.toISOString(),
                mainEntityOfPage: {
                    "@type": "WebPage",
                    "@id": Astro.url.href,
                },
                keywords: tags.join(", "),
            })}
        />
    </Fragment>
    
    <div class="container container-sm pt-32 pb-16">
        <!-- Article Header -->
        <header class="mb-16 text-center">
            <h1 class="text-4xl md:text-5xl font-bold mb-6 text-text-primary leading-tight">
                {title}
            </h1>
            
            <div class="flex items-center justify-center gap-4 mb-8 text-sm text-text-tertiary font-mono">
                <time datetime={pubDate.toISOString()}>
                    {formattedDate}
                </time>
                <span>â€¢</span>
                <span>{readingTime}</span>
            </div>

            <div class="flex flex-wrap justify-center gap-2">
                {
                    tags.map((tag) => (
                        <span class="text-xs font-medium text-text-tertiary px-3 py-1 rounded-full bg-white/5 border border-white/5">
                            {tag}
                        </span>
                    ))
                }
            </div>
        </header>

        <div class="divider my-12"></div>

        <!-- Article Content -->
        <div class="content-bg-subtle">
            <article class="blog-content prose prose-invert max-w-none prose-lg prose-headings:text-text-primary prose-p:text-text-secondary prose-a:text-accent-primary hover:prose-a:text-accent-secondary prose-strong:text-text-primary prose-code:text-accent-primary prose-pre:bg-surface-elevated prose-pre:border prose-pre:border-white/5">
                <slot />
                <CodeBlock />
            </article>
        </div>

        <div class="divider my-16"></div>

        <!-- Post Navigation -->
        {(prevPost || nextPost) && (
            <nav class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-16">
                {prevPost ? (
                    <a
                        href={`/blog/${prevPost.slug}`}
                        class="group block p-6 rounded-2xl border border-white/10 bg-white/5 hover:bg-white/10 hover:border-white/20 transition-all duration-300 text-left"
                    >
                        <div class="text-xs text-text-tertiary mb-2 font-mono">Previous Post</div>
                        <h3 class="text-lg font-semibold text-text-primary group-hover:text-accent-primary transition-colors mb-2">
                            {prevPost.data.title}
                        </h3>
                    </a>
                ) : (
                    <div />
                )}

                {nextPost ? (
                    <a
                        href={`/blog/${nextPost.slug}`}
                        class="group block p-6 rounded-2xl border border-white/10 bg-white/5 hover:bg-white/10 hover:border-white/20 transition-all duration-300 text-right"
                    >
                        <div class="text-xs text-text-tertiary mb-2 font-mono">Next Post</div>
                        <h3 class="text-lg font-semibold text-text-primary group-hover:text-accent-primary transition-colors mb-2">
                            {nextPost.data.title}
                        </h3>
                    </a>
                ) : (
                    <div />
                )}
            </nav>
        )}

        <!-- Hiring Notice -->
        <section class="mb-16">
            <HiringNotice />
        </section>

        <!-- Navigation -->
        <div class="text-center">
            <a href="/blog" class="btn btn-ghost link-arrow">
                Back to Blog
            </a>
        </div>
    </div>
</Layout>
