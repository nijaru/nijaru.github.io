---
import Layout from "../../layouts/Layout.astro";
import ReflectionText from "../../components/ReflectionText";
import BlogPostPreview from "../../components/BlogPostPreview";
import { getCollection } from "astro:content";

// Get all blog posts from the collection
const blogEntries = await getCollection("blog", ({ data }) => {
    // Filter out draft posts in production
    return import.meta.env.PROD ? !data.draft : true;
});

// Format and prepare post data
const posts = blogEntries
    .map((post) => {
        // Format the date for display
        const formattedDate = post.data.pubDate.toLocaleDateString("en-US", {
            year: "numeric",
            month: "long",
            day: "numeric",
        });

        return {
            url: `/blog/${post.slug}`,
            title: post.data.title,
            pubDate: post.data.pubDate,
            formattedDate: formattedDate,
            excerpt: post.data.description,
            tags: post.data.tags,
        };
    })
    // Sort posts by date (newest first)
    .sort((a, b) => b.pubDate.getTime() - a.pubDate.getTime());
---

<Layout title="Blog - Nick Russo">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <h1 class="text-4xl font-bold mb-2 text-center">
            <span class="text-accent-blue">
                <ReflectionText client:load>My</ReflectionText>
            </span>
            <span class="text-white">
                <ReflectionText client:load>Blog</ReflectionText>
            </span>
        </h1>

        <div class="text-center mb-12">
            <p class="text-gray-400 mb-4">
                Thoughts on software development, programming languages, and more
            </p>
            <a 
                href="/rss.xml" 
                class="inline-flex items-center text-accent-blue hover:text-blue-400 text-sm font-medium transition-colors"
                target="_blank"
                rel="noopener noreferrer"
            >
                <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                    <path d="M5 3a1 1 0 000 2c5.523 0 10 4.477 10 10a1 1 0 102 0C17 8.373 11.627 3 5 3z"></path>
                    <path d="M4 9a1 1 0 011-1 7 7 0 017 7 1 1 0 11-2 0A5 5 0 009 10a1 1 0 01-1-1z"></path>
                    <path d="M3 15a2 2 0 104 0 2 2 0 00-4 0z"></path>
                </svg>
                RSS Feed
            </a>
        </div>

        <div class="content-backdrop">
            <div class="space-y-8">
                {posts.map((post) => <BlogPostPreview post={post} />)}

                {
                    posts.length === 0 && (
                        <div class="text-center py-12 text-gray-500">
                            <p>No posts found. Check back soon!</p>
                        </div>
                    )
                }
            </div>
        </div>

        <div class="text-center mt-12">
            <a
                href="/"
                class="inline-flex items-center text-accent-blue hover:text-accent-blue"
            >
                Back to Home
                <svg
                    class="w-4 h-4 ml-1"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                    xmlns="http://www.w3.org/2000/svg"
                    aria-hidden="true"
                >
                    <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M13 7l5 5m0 0l-5 5m5-5H6"
                    ></path>
                </svg>
            </a>
        </div>
    </div>
</Layout>
