---
import { getCollection } from 'astro:content';
import BlogPost from '../../layouts/BlogPost.astro';

export async function getStaticPaths() {
  const blogEntries = await getCollection('blog', ({ data }) => {
    // Filter out draft posts in production
    return import.meta.env.PROD ? !data.draft : true;
  });

  // Sort by date descending (newest first)
  const sortedEntries = blogEntries.sort((a, b) =>
    b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
  );

  return sortedEntries.map((entry, index) => {
    const prevPost = index < sortedEntries.length - 1 ? sortedEntries[index + 1] : null;
    const nextPost = index > 0 ? sortedEntries[index - 1] : null;

    return {
      params: { slug: entry.slug },
      props: { entry, prevPost, nextPost },
    };
  });
}

const { entry, prevPost, nextPost } = Astro.props;
const { Content } = await entry.render();
---

<BlogPost post={entry} prevPost={prevPost} nextPost={nextPost}>
  <Content />
</BlogPost>