---
import Layout from "../layouts/Layout.astro";
import ReflectionText from "../components/ReflectionText";
import TextGlow from "../components/TextGlow";
import BlogPostPreview from "../components/BlogPostPreview";
import GithubRepos from "../components/GithubRepos.tsx";
import ErrorBoundary from "../components/ErrorBoundary.tsx";
import ArrowLink from "../components/ArrowLink";
import SectionHeading from "../components/SectionHeading";
import SocialLinks from "../components/SocialLinks";
import { getCollection } from 'astro:content';

// Get all blog posts from the collection
const blogEntries = await getCollection('blog', ({ data }) => {
  // Filter out draft posts in production
  return import.meta.env.PROD ? !data.draft : true;
});

// Format and prepare post data
const allPosts = blogEntries
  .map(post => {
    // Format the date for display
    const formattedDate = post.data.pubDate.toLocaleDateString("en-US", {
      year: "numeric",
      month: "long",
      day: "numeric",
    });
    
    return {
      url: `/blog/${post.slug}`,
      title: post.data.title,
      pubDate: post.data.pubDate,
      formattedDate: formattedDate,
      excerpt: post.data.description,
      tags: post.data.tags
    };
  })
  // Sort posts by date (newest first)
  .sort((a, b) => b.pubDate.getTime() - a.pubDate.getTime());

// Get the most recent post (or undefined if no posts)
const mostRecentPost = allPosts.length > 0 ? allPosts[0] : undefined;
---

<Layout title="Nick Russo - Software Developer">
    <div class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8">
        <!-- Hero Section -->
        <header class="py-16 md:py-24">
            <h1 class="text-4xl md:text-5xl font-bold mb-3">
                <span class="text-accent-blue">Nick Russo</span>
            </h1>
            <p class="text-xl md:text-2xl text-gray-300 mb-8">
                Software developer building systems and tools
            </p>
            <SocialLinks client:visible />
        </header>

        <!-- Current Work -->
        <section class="py-12 border-t border-white/10">
            <h2 class="text-lg font-semibold text-white mb-6">What I'm working on</h2>
            <div class="space-y-6 text-gray-300">
                <p>
                    I'm a software developer specializing in backend systems and distributed applications. 
                    With experience in Python, Go, and various cloud technologies, I build reliable and 
                    efficient solutions for complex problems.
                </p>
                <p>
                    Currently exploring AI applications, database innovations, and modern frontend frameworks 
                    like Solid.js and Astro. Passionate about building solutions that solve real-world problems.
                </p>
            </div>
            <div class="mt-6">
                <a 
                    href="/about" 
                    class="text-accent-blue hover:text-blue-400 text-sm font-medium transition-colors"
                >
                    More about me →
                </a>
            </div>
        </section>

        <!-- Recent Writing -->
        {mostRecentPost && (
            <section class="py-12 border-t border-white/10">
                <h2 class="text-lg font-semibold text-white mb-6">Recent writing</h2>
                <div class="group">
                    <a href={mostRecentPost.url} class="block">
                        <h3 class="text-xl font-medium text-white group-hover:text-accent-blue transition-colors mb-2">
                            {mostRecentPost.title}
                        </h3>
                        <p class="text-gray-400 text-sm mb-3">{mostRecentPost.formattedDate}</p>
                        <p class="text-gray-300">{mostRecentPost.excerpt}</p>
                    </a>
                </div>
                <div class="mt-6">
                    <a 
                        href="/blog" 
                        class="text-accent-blue hover:text-blue-400 text-sm font-medium transition-colors"
                    >
                        All posts →
                    </a>
                </div>
            </section>
        )}

        <!-- Projects -->
        <section class="py-12 border-t border-white/10">
            <h2 class="text-lg font-semibold text-white mb-6">Featured repositories</h2>
            <ErrorBoundary client:idle>
                <GithubRepos client:idle username="nijaru" limit={2} />
            </ErrorBoundary>
            <div class="mt-6">
                <a 
                    href="/projects" 
                    class="text-accent-blue hover:text-blue-400 text-sm font-medium transition-colors"
                >
                    All projects →
                </a>
            </div>
        </section>
    </div>
</Layout>
