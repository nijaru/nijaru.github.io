---
import Layout from '../layouts/Layout.astro';
---

<Layout title="OAuth Callback - DJScout">
  <main class="min-h-screen flex items-center justify-center bg-gradient-to-br from-indigo-600 to-purple-700">
    <div class="text-center p-8 bg-white/10 backdrop-blur-lg rounded-xl shadow-2xl">
      <h1 class="text-3xl font-bold mb-4" style="color: white;">DJScout OAuth Callback</h1>
      <div class="spinner mb-4"></div>
      <p id="message" style="color: white;">Processing authentication...</p>
    </div>
  </main>

  <style>
    .spinner {
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-top: 3px solid white;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 1rem auto;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>

  <script>
    const params = new URLSearchParams(window.location.search);
    const code = params.get('code');
    const error = params.get('error');
    const state = params.get('state');

    const messageEl = document.getElementById('message');

    if (error) {
      messageEl.innerHTML = `<strong>Error:</strong> ${error}`;
    } else if (code) {
      messageEl.innerHTML = `Authorization successful. You can close this window.`;

      // Auto-close after 3 seconds if successful
      setTimeout(() => {
        window.close();
      }, 3000);
    } else {
      messageEl.innerHTML = `<small>Redirect URI endpoint for OAuth services</small>`;
    }
  </script>
</Layout>