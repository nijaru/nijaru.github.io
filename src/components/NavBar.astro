---
const pathname = Astro.url.pathname;

function isActive(path: string, currentPath: string): boolean {
  // Special case for blog - consider active for any path under /blog/
  if (path === '/blog' && (currentPath === '/blog' || currentPath.startsWith('/blog/'))) {
    return true;
  }
  // Direct path match
  return currentPath === path;
}

const navItems = [
  { href: '/', label: 'Home' },
  { href: '/blog', label: 'Blog' },
  { href: '/projects', label: 'Projects' },
];
---

<div class="fixed top-4 left-0 right-0 z-50 flex justify-center px-4 pointer-events-none">
  <nav class="glass-nav rounded-full px-6 py-3 flex items-center justify-between gap-8 transition-all duration-300 ease-out pointer-events-auto">
    <div class="flex items-center">
      <a href="/" class="text-lg font-bold flex items-center text-text-primary hover:text-white transition-colors">
        <span class="text-accent-primary">Nick</span>
        <span class="ml-1">Russo</span>
      </a>
    </div>

    <!-- Desktop Nav -->
    <div class="hidden md:flex items-center gap-1">
      {navItems.map(item => (
        <a
          href={item.href}
          class={`relative px-4 py-2 text-sm font-medium transition-colors rounded-full ${
            isActive(item.href, pathname) 
              ? 'text-white bg-white/10' 
              : 'text-text-secondary hover:text-white hover:bg-white/5'
          }`}
        >
          {item.label}
        </a>
      ))}
      
      <!-- Social Icons -->
      <div class="flex items-center gap-1 ml-2 pl-2 border-l border-white/10">
        <a
          href="https://github.com/nijaru"
          target="_blank"
          rel="noopener noreferrer"
          class="p-2 text-text-secondary hover:text-white hover:bg-white/5 rounded-full transition-colors"
          aria-label="GitHub"
        >
          <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
            <path fill-rule="evenodd" d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z" clip-rule="evenodd" />
          </svg>
        </a>
        <a
          href="https://twitter.com/nijaru0x"
          target="_blank"
          rel="noopener noreferrer"
          class="p-2 text-text-secondary hover:text-white hover:bg-white/5 rounded-full transition-colors"
          aria-label="Twitter / X"
        >
          <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z" />
          </svg>
        </a>
      </div>
    </div>

    <!-- Mobile Menu Button -->
    <button
      id="mobile-menu-button"
      class="md:hidden p-2 rounded-full text-text-secondary hover:text-white hover:bg-white/10 transition-colors"
      aria-expanded="false"
      aria-controls="mobile-menu"
      aria-label="Open main menu"
    >
      <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
      </svg>
    </button>
  </nav>

  <!-- Mobile Menu Dropdown (Detached) -->
  <div 
    id="mobile-menu" 
    class="hidden absolute top-20 left-4 right-4 glass-nav rounded-2xl p-2 flex-col gap-1 transform origin-top transition-all duration-200 scale-95 opacity-0 pointer-events-auto"
    role="navigation"
  >
    {navItems.map(item => (
      <a 
        href={item.href} 
        class={`block px-4 py-3 text-base font-medium rounded-xl transition-colors ${
          isActive(item.href, pathname) 
            ? 'text-white bg-white/10' 
            : 'text-text-secondary hover:text-white hover:bg-white/5'
        }`}
      >
        {item.label}
      </a>
    ))}
  </div>
</div>

<style>
  .glass-nav {
    background: rgba(22, 23, 29, 0.7);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    border: 1px solid rgba(255, 255, 255, 0.08);
    box-shadow: 
      0 4px 6px -1px rgba(0, 0, 0, 0.1),
      0 2px 4px -1px rgba(0, 0, 0, 0.06),
      inset 0 1px 0 rgba(255, 255, 255, 0.1);
  }

  /* Mobile menu animation classes */
  #mobile-menu.open {
    display: flex;
    transform: scale(100%);
    opacity: 1;
  }
</style>

<script>
  const button = document.getElementById('mobile-menu-button');
  const menu = document.getElementById('mobile-menu');
  const icon = button?.querySelector('svg path');
  
  let isOpen = false;
  
  button?.addEventListener('click', (e) => {
    e.stopPropagation();
    isOpen = !isOpen;
    
    if (isOpen) {
      menu?.classList.remove('hidden');
      // Small delay to allow display:flex to apply before transition
      requestAnimationFrame(() => {
        menu?.classList.add('open');
      });
    } else {
      menu?.classList.remove('open');
      // Wait for transition to finish before hiding
      setTimeout(() => {
        menu?.classList.add('hidden');
      }, 200);
    }
    
    button.setAttribute('aria-expanded', isOpen.toString());
    
    if (icon) {
      icon.setAttribute('d', isOpen ? 'M6 18L18 6M6 6l12 12' : 'M4 6h16M4 12h16M4 18h16');
    }
  });

  // Close on click outside
  document.addEventListener('click', (e) => {
    if (isOpen && !menu?.contains(e.target as Node) && !button?.contains(e.target as Node)) {
      isOpen = false;
      menu?.classList.remove('open');
      setTimeout(() => {
        menu?.classList.add('hidden');
      }, 200);
      
      button?.setAttribute('aria-expanded', 'false');
      if (icon) {
        icon.setAttribute('d', 'M4 6h16M4 12h16M4 18h16');
      }
    }
  });
</script>
